# Рекомендации по проекту `reestr-mkd`

## Что уже хорошо
- Есть отдельный слой `ApiService`, контекст проекта и хуки, то есть код уже частично разложен по слоям.
- Есть аудит workflow по шагам 1–17, и по нему критичные пробелы уже закрывались.
- Базовые проверки качества проходят (`eslint`, production build).

## Приоритет 1 (масштабируемость и производительность)
1. **Разбить `App.jsx` на lazy-route чанки**: сейчас редакторы и панели тянутся единым импортом в корневом компоненте.
2. **Декомпозировать `ApiService`**: файл уже >1500 строк, есть смешение workflow, CRUD и интеграции.
3. **Усилить покрытие тестами для heavy-данных**: парсинг и сохранение floor/entrance матриц уже реализованы, теперь важно закрепить это интеграционными тестами.
4. **Добавить контроль bundle budget** (например, проверка размера бандла в CI), чтобы удерживать рост JS.

## Приоритет 2 (поддерживаемость и качество разработки)
1. **Автотесты на критичный workflow**:
   - unit-тесты для мапперов и валидаторов;
   - интеграционные тесты для `ApiService` (mock Supabase);
   - e2e smoke по шагам workflow.
2. **Единый error-handling контракт** для API-слоя (типизированные ошибки/коды), чтобы UI не ловил «сырые» исключения.
3. **Документировать архитектурные границы** (что хранится в контексте, что — в React Query, что — только в БД).
4. **Подготовить migration playbook для PROD** отдельно от `reset_schema.sql` (reset полезен для DEV, но нужен безопасный путь эволюции схемы).

## Предложенный план внедрения (4 недели)
- **Неделя 1**: lazy routes + первичная декомпозиция `ApiService` по доменным модулям.
- **Неделя 2**: тесты для мапперов/валидаторов и smoke e2e.
- **Неделя 3**: CI-checks (bundle budget, тесты, lint/build gates).
- **Неделя 4**: migration playbook для PROD и формализация границ архитектуры.
